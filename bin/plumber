#!/usr/bin/env php
<?php
use Codeages\Plumber\Plumber;

$autoloader = require __DIR__.'/../src/composer_autoload.php';

if (!$autoloader()) {
    die('class autoloader not found.');
}

array_shift($argv);

$options = [];
$argments = [];
foreach ($argv as $arg) {
    $arg = explode('=', $arg);
    if ($arg[0][0] == '-') {
        $key = trim($arg[0], '-');
        $value = isset($arg[1]) ? $arg[1] : null;
        $options[$key] = $value; 
    } else {
        $argments[] = $arg[0];
    }
}

if (isset($options['env'])) {
    putenv("ENV={$options['env']}");
}

$config = include $argv[1];

if (!empty($config['bootstrap'])) {
    include $config['bootstrap'];
}

if (empty($argv[0]) || !in_array($argv[0], array('start', 'stop', 'restart', 'status')) ) {
    echo "Please input: bin/plumber start|stop|restart|status\n";
    exit();
}

$daemon = new Plumber($config);

$daemon->main($argv[0]);
